<div class="flex-1 p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Banners Heading -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h1 class="text-gray-900 dark:text-white text-3xl font-black tracking-tight">Gestión de Banners</h1>
          <p class="text-gray-600 dark:text-gray-400 mt-1">Gestiona banners flexibles e inteligentes para tu tienda</p>
        </div>
        <button
          (click)="openForm()"
          class="px-4 py-2 rounded-lg bg-primary-admin text-white font-semibold hover:bg-primary-admin/90 flex items-center gap-2">
          <span class="material-symbols-outlined">add</span>
          Nuevo Banner
        </button>
      </div>

      <!-- Filtros -->
      <div class="bg-white dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-800 p-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo</label>
            <select
              [(ngModel)]="filtroTipo"
              (change)="applyFilters()"
              class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm">
              <option [value]="null">Todos</option>
              @for (tipo of BANNER_TIPOS; track tipo.value) {
                <option [value]="tipo.value">{{ tipo.label }}</option>
              }
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Posición</label>
            <select
              [(ngModel)]="filtroPosicion"
              (change)="applyFilters()"
              class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm">
              <option [value]="null">Todas</option>
              @for (pos of BANNER_POSICIONES; track pos.value) {
                <option [value]="pos.value">{{ pos.label }}</option>
              }
            </select>
          </div>
          <div class="flex items-end">
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                [(ngModel)]="filtroSoloActivos"
                (change)="applyFilters()"
                class="w-4 h-4 text-primary-admin">
              <span class="text-sm text-gray-700 dark:text-gray-300">Solo activos</span>
            </label>
          </div>
          <div class="flex items-end">
            <button
              (click)="clearFilters()"
              class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm hover:bg-gray-50 dark:hover:bg-gray-700">
              Limpiar Filtros
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Banners List -->
    @if (isLoading()) {
      <div class="text-center py-12 text-gray-500">Cargando banners...</div>
    } @else if (banners().length === 0) {
      <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-12 text-center">
        <span class="material-symbols-outlined text-6xl text-gray-400 mb-4 block">image</span>
        <p class="text-gray-500 dark:text-gray-400 text-lg mb-2">No hay banners registrados</p>
        <p class="text-gray-400 dark:text-gray-500 text-sm mb-4">Comienza creando tu primer banner</p>
        <button
          (click)="openForm()"
          class="px-4 py-2 bg-primary-admin text-white font-semibold rounded-lg hover:bg-primary-admin/90">
          Crear Primer Banner
        </button>
      </div>
    } @else {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (banner of banners(); track banner.id) {
          <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden hover:shadow-md transition-shadow">
            @if (banner.imagenUrl) {
              <div class="w-full h-48 bg-gray-200 dark:bg-gray-800 overflow-hidden relative">
                <img [src]="banner.imagenUrl" [alt]="banner.titulo" class="w-full h-full object-cover">
                <div class="absolute top-2 right-2 flex gap-2">
                  @if (isBannerActive(banner)) {
                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-semibold">Activo</span>
                  } @else {
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">Inactivo</span>
                  }
                </div>
              </div>
            } @else {
              <div class="w-full h-48 bg-gradient-to-br from-primary-admin/20 to-primary-admin/10 flex items-center justify-center">
                <span class="material-symbols-outlined text-6xl text-primary-admin/50">image</span>
              </div>
            }
            <div class="p-6">
              <div class="flex items-start justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white line-clamp-2 flex-1">{{ banner.titulo }}</h3>
              </div>
              @if (banner.descripcion) {
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2">{{ banner.descripcion }}</p>
              }
              <div class="flex flex-wrap gap-2 mb-3 text-xs">
                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full">{{ getBannerTipoLabel(banner.tipo) }}</span>
                <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full">{{ getBannerPosicionLabel(banner.posicion) }}</span>
                @if (banner.soloMovil) {
                  <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full">Solo Móvil</span>
                }
                @if (banner.soloDesktop) {
                  <span class="px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full">Solo Desktop</span>
                }
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 mb-4 space-y-1">
                <p>Orden: {{ banner.orden }}</p>
                @if (banner.fechaInicio || banner.fechaFin) {
                  <p>
                    @if (banner.fechaInicio) {
                      Desde: {{ formatDate(banner.fechaInicio) }}
                    }
                    @if (banner.fechaFin) {
                      Hasta: {{ formatDate(banner.fechaFin) }}
                    }
                  </p>
                }
                @if (banner.maxVisualizaciones) {
                  <p>Visualizaciones: {{ banner.visualizacionesActuales }} / {{ banner.maxVisualizaciones }}</p>
                } @else {
                  <p>Visualizaciones: {{ banner.visualizacionesActuales }}</p>
                }
              </div>
              <div class="flex gap-2">
                <button
                  (click)="openForm(banner)"
                  class="flex-1 px-3 py-2 rounded-lg bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-100 text-sm">
                  <span class="material-symbols-outlined text-sm align-middle mr-1">edit</span>
                  Editar
                </button>
                <button
                  (click)="toggleBannerActivo(banner)"
                  [class.bg-green-100]="!banner.activo"
                  [class.text-green-700]="!banner.activo"
                  [class.bg-gray-100]="banner.activo"
                  [class.text-gray-700]="banner.activo"
                  class="px-3 py-2 rounded-lg font-semibold hover:opacity-80 text-sm">
                  {{ banner.activo ? 'Desactivar' : 'Activar' }}
                </button>
                <button
                  (click)="deleteBanner(banner)"
                  class="px-3 py-2 rounded-lg bg-red-100 text-red-700 font-semibold hover:bg-red-200 dark:bg-red-900 dark:text-red-100 text-sm">
                  <span class="material-symbols-outlined text-sm">delete</span>
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Form Modal -->
    @if (showForm()) {
      <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" (click)="closeForm()">
        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
          <div class="p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
              {{ editingBanner() ? 'Editar Banner' : 'Nuevo Banner' }}
            </h2>

            <form (ngSubmit)="saveBanner()">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Título -->
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Título <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    [(ngModel)]="titulo"
                    name="titulo"
                    required
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <!-- Descripción -->
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Descripción</label>
                  <textarea
                    [(ngModel)]="descripcion"
                    name="descripcion"
                    rows="2"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"></textarea>
                </div>

                <!-- URL de Imagen -->
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    URL de Imagen <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="url"
                    [(ngModel)]="imagenUrl"
                    name="imagenUrl"
                    required
                    placeholder="https://ejemplo.com/banner.jpg"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                  @if (imagenUrl().trim()) {
                    <div class="mt-3">
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">Vista previa:</p>
                      <img [src]="imagenUrl()" [alt]="titulo()" class="w-full h-48 object-contain rounded-lg border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"
                           onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'200\'%3E%3Crect fill=\'%23ddd\' width=\'400\' height=\'200\'/%3E%3Ctext fill=\'%23999\' font-family=\'sans-serif\' font-size=\'18\' dy=\'10.5\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\'%3EImagen no disponible%3C/text%3E%3C/svg%3E'">
                    </div>
                  }
                </div>

                <!-- URL Destino -->
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL de Destino</label>
                  <input
                    type="url"
                    [(ngModel)]="urlDestino"
                    name="urlDestino"
                    placeholder="https://ejemplo.com/destino"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                  <div class="flex items-center gap-2 mt-2">
                    <input
                      type="checkbox"
                      [(ngModel)]="abrirEnNuevaVentana"
                      name="abrirEnNuevaVentana"
                      class="w-4 h-4 text-primary-admin">
                    <label class="text-sm text-gray-700 dark:text-gray-300">Abrir en nueva ventana</label>
                  </div>
                </div>

                <!-- Tipo y Posición -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Tipo <span class="text-red-500">*</span>
                  </label>
                  <select
                    [(ngModel)]="tipo"
                    name="tipo"
                    required
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    @for (tipo of BANNER_TIPOS; track tipo.value) {
                      <option [value]="tipo.value">{{ tipo.label }}</option>
                    }
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Posición <span class="text-red-500">*</span>
                  </label>
                  <select
                    [(ngModel)]="posicion"
                    name="posicion"
                    required
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    @for (pos of BANNER_POSICIONES; track pos.value) {
                      <option [value]="pos.value">{{ pos.label }}</option>
                    }
                  </select>
                </div>

                <!-- Fechas -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Fecha de Inicio</label>
                  <input
                    type="date"
                    [(ngModel)]="fechaInicio"
                    name="fechaInicio"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Fecha de Fin</label>
                  <input
                    type="date"
                    [(ngModel)]="fechaFin"
                    name="fechaFin"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <!-- Dimensiones -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ancho Máximo (px)</label>
                  <input
                    type="number"
                    [(ngModel)]="anchoMaximo"
                    name="anchoMaximo"
                    min="0"
                    placeholder="Opcional"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Alto Máximo (px)</label>
                  <input
                    type="number"
                    [(ngModel)]="altoMaximo"
                    name="altoMaximo"
                    min="0"
                    placeholder="Opcional"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <!-- Orden y Límite -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Orden</label>
                  <input
                    type="number"
                    [(ngModel)]="orden"
                    name="orden"
                    min="0"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Menor número = aparece primero</p>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Límite de Visualizaciones</label>
                  <input
                    type="number"
                    [(ngModel)]="maxVisualizaciones"
                    name="maxVisualizaciones"
                    min="0"
                    placeholder="Sin límite"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <!-- Clases CSS -->
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Clases CSS Personalizadas</label>
                  <input
                    type="text"
                    [(ngModel)]="clasesCss"
                    name="clasesCss"
                    placeholder="ej: rounded-lg shadow-md"
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>

                <!-- Opciones de Dispositivo -->
                <div class="md:col-span-2 space-y-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Opciones de Dispositivo</label>
                  <div class="flex gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        [(ngModel)]="soloMovil"
                        name="soloMovil"
                        class="w-4 h-4 text-primary-admin">
                      <span class="text-sm text-gray-700 dark:text-gray-300">Solo Móvil</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        [(ngModel)]="soloDesktop"
                        name="soloDesktop"
                        class="w-4 h-4 text-primary-admin">
                      <span class="text-sm text-gray-700 dark:text-gray-300">Solo Desktop</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        [(ngModel)]="activo"
                        name="activo"
                        class="w-4 h-4 text-primary-admin">
                      <span class="text-sm text-gray-700 dark:text-gray-300">Activo</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex justify-end gap-4 mt-6">
                <button
                  type="button"
                  (click)="closeForm()"
                  class="px-6 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-semibold">
                  Cancelar
                </button>
                <button
                  type="submit"
                  class="px-6 py-2 rounded-lg bg-primary-admin text-white font-semibold hover:bg-primary-admin/90">
                  Guardar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    }
  </div>
</div>

