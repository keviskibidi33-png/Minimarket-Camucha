<div class="flex-1 p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Page Heading -->
    <h1 class="text-gray-900 dark:text-white text-3xl font-black tracking-tight mb-6">Configuraciones del Sistema</h1>

    <!-- Navbar de pestañas -->
    <app-settings-navbar></app-settings-navbar>

    <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
      <!-- Selector de Rol -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Seleccionar Rol
        </label>
        <select
          [value]="selectedRoleId() || ''"
          (change)="onRoleSelected($any($event.target).value)"
          class="w-full md:w-64 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-admin focus:border-primary-admin">
          <option value="">Selecciona un rol</option>
          @for (role of roles(); track role.id) {
            <option [value]="role.id">{{ role.name }}</option>
          }
        </select>
      </div>

      @if (selectedRoleId() && modules().length > 0) {
        <!-- Matriz de Permisos -->
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-800">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Módulo
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Ver
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Crear
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Editar
                </th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                  Eliminar
                </th>
              </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-900/50 divide-y divide-gray-200 dark:divide-gray-700">
              @for (module of modules(); track module.id) {
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div>
                      <div class="text-sm font-medium text-gray-900 dark:text-white">{{ module.nombre }}</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">{{ module.descripcion }}</div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input
                      type="checkbox"
                      [checked]="getPermission(selectedRoleId()!, module.id).canView"
                      (change)="updatePermission(selectedRoleId()!, module.id, 'view', $any($event.target).checked)"
                      class="w-4 h-4 text-primary-admin focus:ring-primary-admin border-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input
                      type="checkbox"
                      [checked]="getPermission(selectedRoleId()!, module.id).canCreate"
                      (change)="updatePermission(selectedRoleId()!, module.id, 'create', $any($event.target).checked)"
                      class="w-4 h-4 text-primary-admin focus:ring-primary-admin border-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input
                      type="checkbox"
                      [checked]="getPermission(selectedRoleId()!, module.id).canEdit"
                      (change)="updatePermission(selectedRoleId()!, module.id, 'edit', $any($event.target).checked)"
                      class="w-4 h-4 text-primary-admin focus:ring-primary-admin border-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input
                      type="checkbox"
                      [checked]="getPermission(selectedRoleId()!, module.id).canDelete"
                      (change)="updatePermission(selectedRoleId()!, module.id, 'delete', $any($event.target).checked)"
                      class="w-4 h-4 text-primary-admin focus:ring-primary-admin border-gray-300 rounded">
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex justify-end">
          <button
            (click)="savePermissions()"
            [disabled]="isSaving()"
            class="px-6 py-2 rounded-lg bg-primary-admin text-white font-semibold hover:bg-primary-admin/90 disabled:opacity-50 disabled:cursor-not-allowed">
            @if (isSaving()) {
              Guardando...
            } @else {
              Guardar Permisos
            }
          </button>
        </div>
      } @else {
        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
          @if (isLoading()) {
            <p>Cargando permisos...</p>
          } @else {
            <p>Selecciona un rol para gestionar sus permisos</p>
          }
        </div>
      }
    </div>
  </div>
</div>

