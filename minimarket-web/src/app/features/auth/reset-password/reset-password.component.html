<div class="relative flex min-h-screen w-full flex-col items-center justify-center bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;' [@fadeSlide]>
  <div class="w-full max-w-md p-6">
    <div class="flex flex-col items-center rounded-xl border border-border-light/50 bg-card-light p-8 shadow-sm dark:border-border-dark/50 dark:bg-card-dark">
      <!-- Logo and Title -->
      <div class="mb-6 flex flex-col items-center">
        <div class="mb-4">
          <span class="material-symbols-outlined text-6xl text-primary">lock_reset</span>
        </div>
        <h1 class="text-2xl font-bold tracking-tight text-text-light dark:text-text-dark">Restablecer Contraseña</h1>
        <p class="mt-1 text-base text-text-light/70 dark:text-text-dark/70">Ingresa tu nueva contraseña</p>
      </div>

      @if (invalidToken()) {
        <!-- Invalid Token Message -->
        <div class="w-full text-center">
          <div class="mb-4">
            <span class="material-symbols-outlined text-6xl text-red-500">error</span>
          </div>
          <h2 class="text-xl font-bold text-text-light dark:text-text-dark mb-2">Enlace Inválido</h2>
          <p class="text-gray-500 dark:text-gray-400 mb-6">
            El enlace de recuperación no es válido o ha expirado. Por favor, solicita un nuevo enlace.
          </p>
          <div class="flex flex-col gap-3">
            <button
              (click)="goToForgotPassword()"
              class="flex h-12 w-full min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary px-5 text-base font-bold leading-normal text-white transition-colors duration-200 hover:bg-primary/90">
              Solicitar Nuevo Enlace
            </button>
            <button
              (click)="goToLogin()"
              class="flex h-12 w-full min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg border border-border-light dark:border-border-dark bg-white dark:bg-background-dark px-5 text-base font-medium leading-normal text-text-light dark:text-text-dark transition-colors duration-200 hover:bg-gray-50 dark:hover:bg-gray-800">
              Volver al Login
            </button>
          </div>
        </div>
      } @else {
        <!-- Form -->
        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="w-full">
          <div class="flex w-full flex-col gap-4">
            <!-- Email Display (readonly) -->
            @if (email()) {
              <div class="flex w-full flex-col">
                <label class="mb-2 text-sm font-medium text-text-light dark:text-text-dark">Correo Electrónico</label>
                <div class="relative flex w-full items-center">
                  <span class="material-symbols-outlined pointer-events-none absolute left-3 text-xl text-placeholder-light dark:text-placeholder-dark">email</span>
                  <input
                    class="form-input h-12 w-full min-w-0 flex-1 rounded-lg border border-border-light bg-background-light py-2 pl-10 pr-3 text-base text-text-light placeholder-placeholder-light ring-primary/50 transition-all duration-200 focus:border-primary focus:outline-none focus:ring-2 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder-placeholder-dark dark:focus:border-primary"
                    type="email"
                    [value]="email()"
                    readonly
                    disabled>
                </div>
              </div>
            }

            <!-- Password Field -->
            <div class="flex w-full flex-col">
              <label class="mb-2 text-sm font-medium text-text-light dark:text-text-dark" for="password">Nueva Contraseña</label>
              <div class="relative flex w-full items-center">
                <span class="material-symbols-outlined pointer-events-none absolute left-3 text-xl text-placeholder-light dark:text-placeholder-dark">lock</span>
                <input
                  class="form-input h-12 w-full min-w-0 flex-1 rounded-lg border border-border-light bg-background-light py-2 pl-10 pr-10 text-base text-text-light placeholder-placeholder-light ring-primary/50 transition-all duration-200 focus:border-primary focus:outline-none focus:ring-2 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder-placeholder-dark dark:focus:border-primary"
                  id="password"
                  [type]="showPassword() ? 'text' : 'password'"
                  placeholder="Mínimo 6 caracteres"
                  formControlName="password"
                  [class.border-red-500]="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched">
                <button
                  type="button"
                  class="absolute right-3 text-placeholder-light dark:text-placeholder-dark hover:text-text-light dark:hover:text-text-dark"
                  (click)="togglePasswordVisibility()">
                  <span class="material-symbols-outlined text-xl">
                    {{ showPassword() ? 'visibility' : 'visibility_off' }}
                  </span>
                </button>
              </div>
              @if (resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched) {
                <span class="mt-1 text-sm text-red-500">La contraseña es requerida (mínimo 6 caracteres)</span>
              }
            </div>

            <!-- Confirm Password Field -->
            <div class="flex w-full flex-col">
              <label class="mb-2 text-sm font-medium text-text-light dark:text-text-dark" for="confirmPassword">Confirmar Nueva Contraseña</label>
              <div class="relative flex w-full items-center">
                <span class="material-symbols-outlined pointer-events-none absolute left-3 text-xl text-placeholder-light dark:text-placeholder-dark">lock</span>
                <input
                  class="form-input h-12 w-full min-w-0 flex-1 rounded-lg border border-border-light bg-background-light py-2 pl-10 pr-10 text-base text-text-light placeholder-placeholder-light ring-primary/50 transition-all duration-200 focus:border-primary focus:outline-none focus:ring-2 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder-placeholder-dark dark:focus:border-primary"
                  id="confirmPassword"
                  [type]="showConfirmPassword() ? 'text' : 'password'"
                  placeholder="Confirma tu nueva contraseña"
                  formControlName="confirmPassword"
                  [class.border-red-500]="(resetPasswordForm.get('confirmPassword')?.invalid || resetPasswordForm.errors?.['passwordMismatch']) && resetPasswordForm.get('confirmPassword')?.touched">
                <button
                  type="button"
                  class="absolute right-3 text-placeholder-light dark:text-placeholder-dark hover:text-text-light dark:hover:text-text-dark"
                  (click)="toggleConfirmPasswordVisibility()">
                  <span class="material-symbols-outlined text-xl">
                    {{ showConfirmPassword() ? 'visibility' : 'visibility_off' }}
                  </span>
                </button>
              </div>
              @if (resetPasswordForm.errors?.['passwordMismatch'] && resetPasswordForm.get('confirmPassword')?.touched) {
                <span class="mt-1 text-sm text-red-500">Las contraseñas no coinciden</span>
              }
            </div>

            <!-- Error Message -->
            @if (errorMessage()) {
              <div class="rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-3">
                <p class="text-sm text-red-600 dark:text-red-400">{{ errorMessage() }}</p>
              </div>
            }

            <!-- Submit Button -->
            <div class="pt-4">
              <button
                type="submit"
                [disabled]="resetPasswordForm.invalid || isLoading()"
                class="flex h-12 w-full min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary px-5 text-base font-bold leading-normal text-white transition-colors duration-200 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 dark:focus:ring-offset-background-dark disabled:opacity-50 disabled:cursor-not-allowed">
                @if (isLoading()) {
                  <span class="material-symbols-outlined animate-spin mr-2">refresh</span>
                }
                <span class="truncate">Restablecer Contraseña</span>
              </button>
            </div>
          </div>
        </form>

        <!-- Back to Login Link -->
        <div class="mt-6 w-full text-center">
          <a 
            (click)="goToLogin()"
            class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 focus:outline-none focus:underline cursor-pointer">
            Volver al inicio de sesión
          </a>
        </div>
      }
    </div>
  </div>
</div>

