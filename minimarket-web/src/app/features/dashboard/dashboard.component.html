<div class="flex-1 p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-gray-900 dark:text-white text-3xl font-black tracking-tight mb-6">
      Dashboard
    </h1>

    @if (isLoading()) {
      <div class="flex items-center justify-center py-12">
        <span class="material-symbols-outlined animate-spin text-primary-admin text-4xl">refresh</span>
      </div>
    } @else if (stats()) {
      <!-- Quick Actions - Compacta arriba de las métricas -->
      <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-4 mb-6">
        <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Acciones Rápidas</h3>
        <div class="grid grid-cols-4 gap-3">
          <a routerLink="/admin/pos" class="flex flex-col items-center p-3 bg-primary-admin/10 rounded-lg hover:bg-primary-admin/20 transition-colors">
            <span class="material-symbols-outlined text-primary-admin text-2xl mb-1">point_of_sale</span>
            <span class="text-xs font-medium text-gray-900 dark:text-white text-center">Nueva Venta</span>
          </a>
          <a routerLink="/admin/productos/nuevo" class="flex flex-col items-center p-3 bg-green-500/10 rounded-lg hover:bg-green-500/20 transition-colors">
            <span class="material-symbols-outlined text-green-500 text-2xl mb-1">add_shopping_cart</span>
            <span class="text-xs font-medium text-gray-900 dark:text-white text-center">Nuevo Producto</span>
          </a>
          <a routerLink="/admin/clientes/nuevo" class="flex flex-col items-center p-3 bg-blue-500/10 rounded-lg hover:bg-blue-500/20 transition-colors">
            <span class="material-symbols-outlined text-blue-500 text-2xl mb-1">person_add</span>
            <span class="text-xs font-medium text-gray-900 dark:text-white text-center">Nuevo Cliente</span>
          </a>
          <a routerLink="/admin/ventas" class="flex flex-col items-center p-3 bg-purple-500/10 rounded-lg hover:bg-purple-500/20 transition-colors">
            <span class="material-symbols-outlined text-purple-500 text-2xl mb-1">receipt_long</span>
            <span class="text-xs font-medium text-gray-900 dark:text-white text-center">Ver Ventas</span>
          </a>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <!-- Ventas Hoy -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="total-sales">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Ventas Hoy</h3>
            <span class="material-symbols-outlined text-green-500">trending_up</span>
          </div>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mb-1">{{ formatCurrency(stats()!.todaySales) }}</p>
          <p class="text-xs text-gray-500">{{ stats()!.todaySalesCount }} ventas</p>
        </div>

        <!-- Ventas del Mes -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="total-profit">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Ventas del Mes</h3>
            <span class="material-symbols-outlined text-blue-500">calendar_month</span>
          </div>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mb-1">{{ formatCurrency(stats()!.monthSales) }}</p>
          <p class="text-xs text-gray-500">{{ stats()!.monthSalesCount }} ventas</p>
        </div>

        <!-- Total Productos -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="transactions-count">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Productos</h3>
            <span class="material-symbols-outlined text-purple-500">inventory_2</span>
          </div>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mb-1">{{ stats()!.totalProducts }}</p>
          <p class="text-xs text-gray-500">activos</p>
        </div>

        <!-- Stock Bajo -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="inventory-value">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Stock Bajo</h3>
            <span class="material-symbols-outlined text-red-500">warning</span>
          </div>
          <p class="text-3xl font-bold text-red-500 mb-1">{{ stats()!.lowStockProducts }}</p>
          <a routerLink="/productos" class="text-xs text-primary-admin hover:underline">Ver productos</a>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Daily Sales Chart (Barras) -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="sales-chart">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Ventas de los Últimos 7 Días</h3>
          <div class="h-64">
            <canvas baseChart
              [data]="barChartData"
              [options]="barChartOptions"
              type="bar">
            </canvas>
          </div>
        </div>

        <!-- Sales Trend Chart (Líneas) -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Tendencia de Ventas</h3>
          <div class="h-64">
            <canvas baseChart
              [data]="lineChartData"
              [options]="lineChartOptions"
              type="line">
            </canvas>
          </div>
        </div>
      </div>

      <!-- Tables Row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Top Products -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6" data-cy="top-products">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Productos Más Vendidos</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
              <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800">
                <tr>
                  <th class="px-4 py-3" scope="col">Producto</th>
                  <th class="px-4 py-3" scope="col">Cantidad</th>
                  <th class="px-4 py-3 text-right" scope="col">Total</th>
                </tr>
              </thead>
              <tbody>
                @if (stats()!.topProducts.length === 0) {
                  <tr>
                    <td colspan="3" class="px-4 py-8 text-center text-gray-500">
                      No hay datos disponibles
                    </td>
                  </tr>
                } @else {
                  @for (product of stats()!.topProducts; track product.productId) {
                    <tr class="bg-white dark:bg-gray-900/50 border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                      <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">{{ product.productName }}</td>
                      <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                          {{ product.quantitySold }} unidades
                        </span>
                      </td>
                      <td class="px-4 py-3 text-right font-semibold text-gray-900 dark:text-white">
                        {{ formatCurrency(product.totalRevenue) }}
                      </td>
                    </tr>
                  }
                }
              </tbody>
            </table>
          </div>
        </div>

        <!-- Recent Sales -->
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
          <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Ventas Recientes</h3>
          @if (isLoadingRecentSales()) {
            <div class="flex items-center justify-center py-8">
              <span class="material-symbols-outlined animate-spin text-primary-admin text-2xl">refresh</span>
            </div>
          } @else if (recentSales().length === 0) {
            <p class="text-sm text-gray-500 text-center py-8">No hay ventas recientes</p>
          } @else {
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800">
                  <tr>
                    <th class="px-4 py-3" scope="col">Documento</th>
                    <th class="px-4 py-3" scope="col">Cliente</th>
                    <th class="px-4 py-3 text-right" scope="col">Total</th>
                    <th class="px-4 py-3" scope="col">Estado</th>
                  </tr>
                </thead>
                <tbody>
                  @for (sale of recentSales(); track sale.id) {
                    <tr class="bg-white dark:bg-gray-900/50 border-b dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                      <td class="px-4 py-3">
                        <a [routerLink]="['/admin/ventas', sale.id]" class="font-medium text-primary-admin hover:underline">
                          {{ sale.documentNumber }}
                        </a>
                      </td>
                      <td class="px-4 py-3 text-gray-900 dark:text-white">
                        {{ sale.customerName || '-' }}
                      </td>
                      <td class="px-4 py-3 text-right font-semibold text-gray-900 dark:text-white">
                        {{ formatCurrency(sale.total) }}
                      </td>
                      <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ getStatusClass(sale.status) }}">
                          {{ sale.status }}
                        </span>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

