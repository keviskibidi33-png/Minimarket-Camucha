<div class="relative flex min-h-screen w-full flex-col">
  <!-- Header -->
  <app-store-header></app-store-header>

  <!-- Main Content -->
  <main class="flex-1 w-full">
    @if (isLoading()) {
      <div class="mx-auto max-w-7xl px-4 py-8 lg:py-16">
        <div class="flex flex-col items-center justify-center min-h-[400px]">
          <span class="material-symbols-outlined animate-spin text-primary text-6xl mb-4">refresh</span>
          <p class="text-gray-600 dark:text-gray-400 text-lg">Cargando oferta...</p>
        </div>
      </div>
    } @else if (error()) {
      <div class="mx-auto max-w-7xl px-4 py-8 lg:py-16">
        <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-12 text-center">
          <div class="text-6xl mb-4 text-red-300 dark:text-red-600">
            <span class="material-symbols-outlined">error</span>
          </div>
          <p class="text-gray-500 dark:text-gray-400 text-lg mb-4">{{ error() }}</p>
          <a routerLink="/tienda/ofertas" class="inline-flex items-center px-6 py-3 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 transition-colors">
            Volver a Ofertas
          </a>
        </div>
      </div>
    } @else if (oferta()) {
      <div class="mx-auto max-w-7xl px-4 py-8 lg:py-16">
        <!-- Hero Section con decoración de promoción -->
        <div class="relative mb-12 rounded-2xl overflow-hidden shadow-xl">
          <!-- Fondo con gradiente de promoción -->
          <div class="absolute inset-0 bg-gradient-to-r from-primary via-secondary to-primary opacity-90"></div>
          
          <!-- Patrón decorativo -->
          <div class="absolute inset-0 opacity-10">
            <div class="absolute inset-0" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);"></div>
          </div>

          <!-- Contenido -->
          <div class="relative p-8 lg:p-12 text-white">
            <!-- Badge de estado -->
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                @if (isExpired(oferta()!)) {
                  <span class="px-4 py-2 bg-red-500/80 backdrop-blur-sm text-white text-sm font-bold rounded-full">
                    Finalizada
                  </span>
                } @else if (isUpcoming(oferta()!)) {
                  <span class="px-4 py-2 bg-yellow-500/80 backdrop-blur-sm text-white text-sm font-bold rounded-full">
                    Próximamente
                  </span>
                } @else {
                  <span class="px-4 py-2 bg-green-500/80 backdrop-blur-sm text-white text-sm font-bold rounded-full">
                    Activa
                  </span>
                }
              </div>
              <button 
                (click)="router.navigate(['/tienda/ofertas'])"
                class="p-2 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-colors">
                <span class="material-symbols-outlined">close</span>
              </button>
            </div>

            <!-- Descuento destacado -->
            <div class="text-6xl lg:text-8xl font-black mb-4 drop-shadow-lg">
              {{ getDescuentoText(oferta()!) }}
            </div>

            <!-- Nombre de la oferta -->
            <h1 class="text-3xl lg:text-5xl font-black mb-4 drop-shadow-md">
              {{ oferta()!.nombre }}
            </h1>

            <!-- Descripción -->
            @if (oferta()!.descripcion) {
              <p class="text-lg lg:text-xl text-white/90 mb-6 max-w-3xl">
                {{ oferta()!.descripcion }}
              </p>
            }

            <!-- Información de fechas -->
            <div class="flex flex-wrap gap-6 text-sm lg:text-base">
              <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
                <span class="material-symbols-outlined">calendar_today</span>
                <span><strong>Inicio:</strong> {{ formatDate(oferta()!.fechaInicio) }}</span>
              </div>
              <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
                <span class="material-symbols-outlined">event</span>
                <span><strong>Fin:</strong> {{ formatDate(oferta()!.fechaFin) }}</span>
              </div>
              <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg">
                <span class="material-symbols-outlined">shopping_bag</span>
                <span>{{ products().length }} producto{{ products().length !== 1 ? 's' : '' }} en oferta</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Productos en Oferta -->
        <div class="mb-8">
          <h2 class="text-3xl lg:text-4xl font-black mb-6 text-text-light dark:text-text-dark">
            Productos en Oferta
          </h2>

          @if (products().length === 0) {
            <div class="bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-12 text-center">
              <div class="text-6xl mb-4 text-gray-300 dark:text-gray-600">
                <span class="material-symbols-outlined">inventory_2</span>
              </div>
              <p class="text-gray-500 dark:text-gray-400 text-lg mb-4">
                No hay productos disponibles en esta oferta
              </p>
              <a routerLink="/tienda/productos" class="inline-flex items-center px-6 py-3 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 transition-colors">
                Ver Todos los Productos
              </a>
            </div>
          } @else {
            <!-- Grid de productos con decoración de promoción -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              @for (product of products(); track product.id) {
                <div class="group relative bg-white dark:bg-gray-900/50 rounded-xl shadow-md border-2 border-transparent hover:border-primary transition-all overflow-hidden hover:shadow-xl">
                  <!-- Badge de oferta en la esquina -->
                  <div class="absolute top-3 right-3 z-10">
                    <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white px-3 py-1 rounded-full text-xs font-black shadow-lg">
                      {{ getDescuentoText(oferta()!) }}
                    </div>
                  </div>

                  <!-- Imagen del producto -->
                  <div class="relative w-full aspect-square bg-gray-100 dark:bg-gray-800 overflow-hidden">
                    @if (product.imageUrl) {
                      <img 
                        [src]="product.imageUrl" 
                        [alt]="product.name"
                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                    } @else {
                      <div class="w-full h-full flex items-center justify-center">
                        <span class="material-symbols-outlined text-gray-400 text-6xl">inventory_2</span>
                      </div>
                    }
                    
                    <!-- Overlay de promoción -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                  </div>

                  <!-- Información del producto -->
                  <div class="p-4">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2">
                      {{ product.name }}
                    </h3>
                    
                    <!-- Precios -->
                    <div class="flex items-baseline gap-2 mb-3">
                      <!-- Precio original tachado -->
                      <span class="text-sm text-gray-500 dark:text-gray-400 line-through">
                        S/ {{ product.salePrice.toFixed(2) }}
                      </span>
                      <!-- Precio con descuento -->
                      <span class="text-2xl font-black text-primary">
                        S/ {{ calculateDiscountedPrice(product, oferta()!).toFixed(2) }}
                      </span>
                    </div>

                    <!-- Ahorro -->
                    <div class="mb-3">
                      <span class="inline-flex items-center px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold rounded">
                        <span class="material-symbols-outlined text-xs mr-1">savings</span>
                        Ahorras S/ {{ (product.salePrice - calculateDiscountedPrice(product, oferta()!)).toFixed(2) }}
                      </span>
                    </div>

                    <!-- Stock -->
                    @if (product.stock > 0) {
                      <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-3">
                        <span class="material-symbols-outlined text-base">inventory</span>
                        <span>{{ product.stock }} disponible{{ product.stock !== 1 ? 's' : '' }}</span>
                      </div>
                    } @else {
                      <div class="flex items-center gap-2 text-sm text-red-600 dark:text-red-400 mb-3">
                        <span class="material-symbols-outlined text-base">cancel</span>
                        <span>Agotado</span>
                      </div>
                    }

                    <!-- Botón agregar al carrito -->
                    <button 
                      (click)="addToCart(product)"
                      [disabled]="product.stock === 0 || isExpired(oferta()!) || isUpcoming(oferta()!)"
                      class="w-full flex items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold hover:bg-primary/90 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                      @if (product.stock === 0) {
                        Sin Stock
                      } @else if (isExpired(oferta()!)) {
                        Oferta Finalizada
                      } @else if (isUpcoming(oferta()!)) {
                        Oferta Próximamente
                      } @else {
                        <span class="material-symbols-outlined text-base mr-2">shopping_cart</span>
                        Agregar al Carrito
                      }
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </main>

  <!-- Footer -->
  <app-store-footer></app-store-footer>
</div>

