<div class="flex min-h-screen w-full bg-background-light dark:bg-background-dark" 
     [class.relative]="!concentrationModeService.isConcentrationMode()"
     [class.fixed]="concentrationModeService.isConcentrationMode()"
     [class.inset-0]="concentrationModeService.isConcentrationMode()"
     [class.z-40]="concentrationModeService.isConcentrationMode()">
  <!-- Sidebar -->
  @if (!concentrationModeService.isConcentrationMode()) {
    <aside [class.w-64]="sidebarOpen" 
           [class.w-0]="!sidebarOpen" 
           [class.opacity-100]="sidebarOpen"
           [class.opacity-0]="!sidebarOpen"
           [class.translate-x-0]="sidebarOpen"
           [class.-translate-x-full]="!sidebarOpen"
           class="flex-shrink-0 bg-white dark:bg-gray-900/50 p-4 flex flex-col justify-between border-r border-gray-200 dark:border-gray-800 transition-all duration-500 ease-in-out overflow-hidden transform">
    <div>
      <!-- Logo -->
      <div class="flex items-center gap-3 p-2 mb-6">
        <img src="assets/logo.png" 
             alt="Minimarket Camucha" 
             class="rounded-lg size-10 object-contain bg-white dark:bg-gray-800 p-1">
        <div class="flex flex-col" [class.hidden]="!sidebarOpen">
          <h1 class="text-gray-900 dark:text-white text-base font-bold leading-normal">{{ brandSettings()?.storeName || 'Minimarket Camucha' }}</h1>
          <p class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal">Admin</p>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex flex-col gap-2" [class.hidden]="!sidebarOpen">
        @if (permissions.canViewDashboard()) {
          <a routerLink="/admin/dashboard" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">dashboard</span>
            <p class="text-sm font-medium leading-normal">Dashboard</p>
          </a>
        }
        @if (permissions.canUsePOS()) {
          <a routerLink="/admin/pos" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">point_of_sale</span>
            <p class="text-sm font-medium leading-normal">Punto de Venta</p>
          </a>
        }
        @if (permissions.canManageSales()) {
          <a routerLink="/admin/ventas" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">receipt_long</span>
            <p class="text-sm font-medium leading-normal">Ventas</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/pedidos" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">shopping_cart</span>
            <p class="text-sm font-medium leading-normal">Pedidos</p>
          </a>
        }
        @if (permissions.canManageProducts()) {
          <a routerLink="/admin/productos" [routerLinkActiveOptions]="{exact: false}" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">inventory_2</span>
            <p class="text-sm font-medium leading-normal">Productos</p>
          </a>
        }
        @if (permissions.canManageCustomers()) {
          <a routerLink="/admin/clientes" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">people</span>
            <p class="text-sm font-medium leading-normal">Clientes</p>
          </a>
        }
        @if (permissions.canManageProducts()) {
          <a routerLink="/admin/categorias" [routerLinkActiveOptions]="{exact: false}" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">category</span>
            <p class="text-sm font-medium leading-normal">Categorías</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/sedes" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">location_on</span>
            <p class="text-sm font-medium leading-normal">Sedes</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/ofertas" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">local_offer</span>
            <p class="text-sm font-medium leading-normal">Ofertas</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/productos-destacados" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">star</span>
            <p class="text-sm font-medium leading-normal">Productos Destacados</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/categorias-populares" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">trending_up</span>
            <p class="text-sm font-medium leading-normal">Categorías Populares</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/page-builder" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">article</span>
            <p class="text-sm font-medium leading-normal">Blog de Noticias</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/analytics" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">analytics</span>
            <p class="text-sm font-medium leading-normal">Analytics</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/configuracion-comprobantes" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">description</span>
            <p class="text-sm font-medium leading-normal">Configuración Comprobantes</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/configuraciones" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">settings</span>
            <p class="text-sm font-medium leading-normal">Configuraciones</p>
          </a>
        }
        @if (permissions.isAdmin()) {
          <a routerLink="/admin/usuarios" routerLinkActive="bg-primary-admin/10 text-primary-admin" 
             class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-primary-admin/10 hover:text-primary-admin dark:hover:text-primary-admin">
            <span class="material-symbols-outlined">people</span>
            <p class="text-sm font-medium leading-normal">Usuarios</p>
          </a>
        }
      </nav>
    </div>

    <!-- Logout -->
    <div [class.hidden]="!sidebarOpen">
      <a (click)="logout()" 
         class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-red-500/10 hover:text-red-500 dark:hover:text-red-500 cursor-pointer">
        <span class="material-symbols-outlined">logout</span>
        <p class="text-sm font-medium leading-normal">Cerrar Sesión</p>
      </a>
    </div>
    </aside>
  }

  <!-- Main Content -->
  <main class="flex-1 flex flex-col overflow-hidden" [class.fixed]="concentrationModeService.isConcentrationMode()" 
        [class.inset-0]="concentrationModeService.isConcentrationMode()" 
        [class.z-50]="concentrationModeService.isConcentrationMode()"
        [class.bg-background-light]="concentrationModeService.isConcentrationMode()"
        [class.dark:bg-background-dark]="concentrationModeService.isConcentrationMode()">
    <!-- Header -->
    @if (!concentrationModeService.isConcentrationMode()) {
      <header class="flex items-center justify-between whitespace-nowrap border-b border-gray-200 dark:border-gray-700 px-6 py-3 bg-white dark:bg-background-dark/50 flex-shrink-0">
        <div class="flex items-center gap-4 text-gray-900 dark:text-white">
          <button (click)="toggleSidebar()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
            <span class="material-symbols-outlined">menu</span>
          </button>
        </div>
        <div class="flex items-center gap-4">
          <span class="text-sm text-gray-600 dark:text-gray-300" data-cy="user-menu">
            {{ (authService.currentUser()?.firstName && authService.currentUser()?.lastName) ? (authService.currentUser()!.firstName + ' ' + authService.currentUser()!.lastName) : (authService.currentUser()?.firstName || authService.currentUser()?.lastName || 'Usuario') }}
          </span>
          @if (authService.currentUser()?.firstName || authService.currentUser()?.lastName) {
            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary text-white text-sm font-bold">
              {{ (authService.currentUser()!.firstName?.charAt(0) || authService.currentUser()!.lastName?.charAt(0) || 'U').toUpperCase() }}
            </div>
          } @else {
            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-600">
              <span class="material-symbols-outlined text-gray-600 dark:text-gray-300">person</span>
            </div>
          }
          <button (click)="logout()" 
                  data-cy="logout-button"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-bold leading-normal tracking-wide hover:bg-gray-200 dark:hover:bg-gray-600">
            <span class="truncate">Cerrar Sesión</span>
          </button>
        </div>
      </header>
    }

    <!-- Content Area -->
    <div class="flex-1 overflow-hidden flex flex-col min-h-0" 
         [class.p-6]="!concentrationModeService.isConcentrationMode()" 
         [class.h-full]="concentrationModeService.isConcentrationMode()">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>

