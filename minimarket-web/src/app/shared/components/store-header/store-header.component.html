<header class="flex w-full items-center justify-center border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-background-dark/80 backdrop-blur-sm sticky top-0" style="z-index: 50; overflow: visible;">
  <div class="flex items-center whitespace-nowrap px-4 md:px-10 py-3 w-full max-w-7xl" style="overflow: visible;">
    <div class="flex items-center gap-8 flex-shrink-0">
      <a routerLink="/" class="flex items-center gap-3 text-text-light dark:text-text-dark">
        @if (brandSettings()?.logoUrl) {
          <img [src]="brandSettings()!.logoUrl" [alt]="brandSettings()?.storeName || 'Logo'" class="h-10 w-auto object-contain">
        } @else {
          <div class="text-primary text-3xl">
            <span class="material-symbols-outlined">storefront</span>
          </div>
        }
        <h2 class="text-xl font-bold tracking-tight">{{ brandSettings()?.storeName || 'Minimarket Camucha' }}</h2>
      </a>
      <nav class="hidden lg:flex items-center gap-6">
        <a routerLink="/" class="text-sm font-medium hover:text-primary" routerLinkActive="text-primary" [routerLinkActiveOptions]="{exact: true}">Inicio</a>
        <a routerLink="/tienda/productos" class="text-sm font-medium hover:text-primary" routerLinkActive="text-primary">Productos</a>
        <a routerLink="/tienda/ofertas" class="text-sm font-medium hover:text-primary" routerLinkActive="text-primary">Ofertas</a>
        <a routerLink="/tienda/contacto" class="text-sm font-medium hover:text-primary" routerLinkActive="text-primary">Contacto</a>
        <!-- Noticias del Blog -->
        @for (page of pages(); track page.id) {
          <a 
            [routerLink]="['/pagina', page.slug]" 
            class="text-sm font-medium hover:text-primary" 
            routerLinkActive="text-primary">
            {{ page.titulo }}
          </a>
        }
      </nav>
    </div>
    <div class="flex flex-1 items-center gap-4 px-4 mx-4 min-w-0" style="position: relative; z-index: 100; overflow: visible;">
      <div class="hidden md:flex flex-1 w-full min-w-0" style="position: relative; overflow: visible; width: 100%;">
        <app-product-autocomplete
          placeholder="Buscar productos..."
          (search)="onSearch($event)"
          (productSelected)="onProductSelected($event)"
          style="width: 100%;">
        </app-product-autocomplete>
      </div>
    </div>
    <div class="flex gap-2 flex-shrink-0">
        <button 
          routerLink="/carrito"
          class="relative flex cursor-pointer items-center justify-center overflow-visible rounded-lg h-10 bg-transparent text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 gap-2 text-sm font-bold min-w-0 px-2.5 transition-colors">
          <span class="material-symbols-outlined">shopping_cart</span>
          @if (cartItemsCount() > 0) {
            <div class="absolute -top-1.5 -right-1.5 flex h-5 w-5 min-w-[20px] items-center justify-center rounded-full bg-secondary text-white text-[10px] font-bold shadow-lg shadow-secondary/50 ring-2 ring-white dark:ring-gray-900 z-10">
              {{ cartItemsCount() }}
            </div>
          }
        </button>
        <!-- User Menu Button -->
        <div class="relative" (clickOutside)="showUserMenu.set(false)">
          @if (isAuthenticated()) {
            <button 
              (click)="toggleUserMenu()"
              class="flex cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-transparent text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
              @if (currentUser()?.firstName || currentUser()?.lastName) {
                <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary text-white text-sm font-bold">
                  {{ (currentUser()!.firstName?.charAt(0) || currentUser()!.lastName?.charAt(0) || 'U').toUpperCase() }}
                </div>
              } @else {
                <span class="material-symbols-outlined">person</span>
              }
            </button>
          } @else {
            <button 
              (click)="toggleUserMenu()"
              class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-transparent text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 gap-2 text-sm font-bold min-w-0 px-2.5 transition-colors">
              <span class="material-symbols-outlined">person</span>
            </button>
          }

          <!-- Dropdown Menu -->
          @if (showUserMenu()) {
            <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-background-dark rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50">
              @if (isAuthenticated()) {
                <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                  <p class="text-sm font-semibold text-text-light dark:text-text-dark">
                    {{ (currentUser()?.firstName && currentUser()?.lastName) ? (currentUser()!.firstName + ' ' + currentUser()!.lastName) : (currentUser()?.firstName || currentUser()?.lastName || 'Usuario') }}
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">{{ currentUser()?.email || currentUser()?.id }}</p>
                </div>
                <button 
                  (click)="goToProfile()"
                  class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2">
                  <span class="material-symbols-outlined text-base">person</span>
                  Mi Perfil
                </button>
                <button 
                  (click)="logout()"
                  class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2">
                  <span class="material-symbols-outlined text-base">logout</span>
                  Cerrar Sesión
                </button>
              } @else {
                <button 
                  (click)="goToLogin()"
                  class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2">
                  <span class="material-symbols-outlined text-base">login</span>
                  Iniciar Sesión
                </button>
                <button 
                  (click)="goToRegister()"
                  class="w-full text-left px-4 py-2 text-sm text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2">
                  <span class="material-symbols-outlined text-base">person_add</span>
                  Registrarse
                </button>
              }
            </div>
          }
        </div>
    </div>
  </div>
</header>

